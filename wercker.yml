box: hseeberger/scala-sbt
build:
  steps:
    - script:
        name: compile
        code: |
          sbt clean compile test

scaladoc:
  steps:
    - script:
        name: Generate Scaladoc
        code: |
          sbt clean compile doc
          ls -als /pipeline/source/target/scala-2.11/api
    - script:
        name: Configure Git
        code: |-
          # git config --global push.default matching
          git config --global push.default simple
          git config --global user.email "$GITHUB_EMAIL"
          git config --global user.name "$GITHUB_USERNAME"
          # https://help.github.com/articles/error-permission-denied-publickey/#platform-all
          # ssh -vT git@github.com
    - script:
        # https://vaadin.com/blog/-/blogs/host-your-javadoc-s-online-in-github
        name: publish scaladoc
        code: |
          cd /pipeline/source/target/scala-2.11/api/
          git init          
          git remote add javadoc https://$GITHUB_USERNAME:$GITHUB_PASSWORD@github.com/logimethods/nats-connector-gatling.git
          git fetch --depth=1 javadoc gh-pages
          git add --all        
          git commit -m "Wercker Build Id: ${WERCKER_BUILD_ID}"
          git merge --no-edit -s ours remotes/javadoc/gh-pages
          git push javadoc master:gh-pages
          
deployX:
    steps:
        - sawatani/maven_central:
            pgp-secring: $SONATYPE_PGP_SECRING_PRIVATE
            pgp-passphrase: $SONATYPE_PASSPHRASE
            repository-username: $SONATYPE_USERNAME
            repository-password: $SONATYPE_PASSWORD

deployZ:
  steps:
    - script:
        name: deploy
        code: |
          base64 --version
          mkdir -p /root/.gnupg/
          echo "${SONATYPE_PGP_SECRING_PRIVATE}" | base64 -i -w 0 > /root/.gnupg/secring.gpg
          echo "${SONATYPE_PGP_SECRING_PUBLIC}" | base64 -i -w 0 > /root/.gnupg/pubring.gpg
          cut -c -15 /root/.gnupg/secring.gpg
          sbt clean compile publishSigned
#          sbt sonatypeRelease

deploy:
  steps:
    - script:
        name: deploy
        code: |
          gpg --gen-key -v -v --batch --passphrase="$SONATYPE_PASSPHRASE"
          ls -als /root/.gnupg/
          more /root/.gnupg/secring.gpg
#          more /root/.gnupg/gpg.conf
#          sbt clean compile publishSigned
#          sbt sonatypeRelease

deployA:
  steps:
    - script:
        name: deploy
        code: |
          echo YOURpassPHRASE|gpg --keyring "/root/.gnupg/" --secret-keyring "/root/.gnupg/" --batch --yes --passphrase-fd 0 --gen-key
          ls -als /root/.gnupg/
          more /root/.gnupg/secring.gpg
          more /root/.gnupg/gpg.conf
#          sbt clean compile publishSigned
#          sbt sonatypeRelease
          
deploy-snapshot:
  steps:
    - script:
        name: deploy-snapshot
        code: |
          sbt clean compile publish
